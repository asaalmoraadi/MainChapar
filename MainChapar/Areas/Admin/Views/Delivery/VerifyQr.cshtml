@model PickupRequest
@{
    ViewData["Title"] = "بررسی سفارش با QR";
}

<h2>جزئیات سفارش</h2>

@if (Model == null)
{
    <div class="alert alert-danger">سفارش یافت نشد.</div>
}
else
{
    <div class="card p-3 my-3">
        <p><strong>کد سفارش:</strong> @Model.Id</p>
        <p><strong>وضعیت:</strong> @Model.Status</p>
        <p><strong>تاریخ ثبت:</strong> @Model.CreatedAt.ToString("yyyy/MM/dd HH:mm")</p>
        <p><strong>تحویل داده شده:</strong> @(Model.IsDelivered ? "بله" : "خیر")</p>

        <h4 class="mt-4">آیتم‌های چاپ:</h4>
        @if (Model.PickupPrintItems.Any())
        {
            <ul>
                @foreach (var item in Model.PickupPrintItems)
                {
                    <li>
                        @item.PrintRequest.Id - وضعیت: @item.PrintRequest.Status
                    </li>
                }
            </ul>
        }
        else
        {
            <p>مورد چاپی ندارد.</p>
        }

        <h4 class="mt-4">محصولات:</h4>
        @if (Model.ProductItems.Any())
        {
            <ul>
                @foreach (var item in Model.ProductItems)
                {
                    <li>@item.Product.Title - تعداد: @item.Quantity</li>
                }
            </ul>
        }
        else
        {
            <p>محصولی ندارد.</p>
        }

        @if (!Model.IsDelivered &&
       (Model.PickupPrintItems.All(p => p.PrintRequest.Status == "آماده تحویل") || !Model.PickupPrintItems.Any()))
        {
            <form asp-action="ConfirmDelivery" method="post">
                <input type="hidden" name="id" value="@Model.Id" />
                <button type="submit" class="btn btn-success mt-3">تحویل نهایی</button>
            </form>
        }
        else if (Model.IsDelivered)
        {
            <div class="alert alert-info mt-3">این سفارش قبلاً تحویل داده شده است.</div>
        }
        else
        {
            <div class="alert alert-warning mt-3">برخی آیتم‌های چاپ هنوز آماده تحویل نیستند.</div>
        }
    </div>
}
